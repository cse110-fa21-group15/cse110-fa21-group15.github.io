<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: search.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: search.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const API_KEY = "apiKey=17d9935d04164997aef523459d06487b";
const API_KEY_ALT = "apiKey=eb8f87242ae8478f9dc126f96c50fda0";
const SEARCH_URL = "https://api.spoonacular.com/recipes/complexSearch?";
const RANDOM_RECIPE_URL = "https://api.spoonacular.com/recipes/random?apiKey=17d9935d04164997aef523459d06487b&amp;number=1";

/**
 * Redirect to results page
 */
 async function redirectPage() {
    console.log("Redirecting to result page");
    window.location.href = "searchresults.html";
}

/**
 * Takes a list of recipes and filters them by cost, and returns the filtered list
 * @param {Array} recipes list of recipes
 * @param {string} cost set cost
 * @return list of recipe with filter applied
 */
function filterCost(recipes, cost) {
    let output;
    if (cost === "") {
        return recipes;
    }
    else {
        output = [];
        for(let i = 0; i &lt; recipes.length; i++) {
            if(recipes[i].pricePerServing > 250){
                if (cost === 3) {
                    output.push(recipes[i]);
                }
            }
            else if (recipes[i].pricePerServing > 125) {
                if (cost === 2) {
                    output.push(recipes[i]);
                }
            }
            else if (cost === 1) {
                output.push(recipes[i]);
            }
        }
    }
    return output;
}

/**
 * Store recipe data retrieved
 * @param {Array} results recipe list
 * @param {string} input  where to store data
 */
async function storeRecipe(results, input) {
    //store data for all sessions, string only
    console.log("Storing recipes to local storage");
    let toStore = await results;
    localStorage.setItem("recipes", JSON.stringify(toStore));
}

/**
 * Retrieve results from local storage
 * @param {string} input where to retrieve data
 */
async function retrieveRecipe(input) {
    console.log("Retrieving recipes from local storage");
    let myStorage = window.localStorage;
    const recipe_example = myStorage.getItem(input + "0");
    console.log(recipe_example);
}

/**
 * Fetches a random recipe
 * @returns random recipe
 */
async function randomRecipe() {
    let recipeData = await fetch(RANDOM_RECIPE_URL).then((response) => {
        return response.json();
    });
    return recipeData["recipes"][0];
}

/**
 * Fetch information about the recipe
 * @param {string} id 
 * @returns data about the recipe
 */
async function recipeInfo(id) {
    let url = "https://api.spoonacular.com/recipes/" + id + "/information?" + API_KEY;
    let recipeData = await fetch(url).then((response) => {
        return response.json();
    });
    localStorage.setItem("extraRecipeInfo", JSON.stringify(recipeData));
    console.log(recipeData);
}

/**
 * Get recipes by searched keywords from database
 * @param event 
 * @param {Boolean} filters 
 * @param {Number} number 
 * @param {Number} offset 
 * @param {Number} currsize 
 * @param {Number} recurse 
 * return list of recipes
 */
 async function getRecipes(event, filters = false, number = 14, offset = 0, currsize = 0, recurse = 0) {    
    // Get User Input
    let input = document.querySelector("input[name = 'search']").value;    
    
    // If no query, then no need to do anything
    // if (input == "") {
    //   return;
    // }

    //Build Base Url
    let url = SEARCH_URL + API_KEY_ALT +"&amp;query=" + input + "&amp;number=" + number + "&amp;instructionsRequired=true" + "&amp;offset=" + offset + "&amp;addRecipeInformation=true";
    let cost;

    //If there are filters, then add time and dietary parameters to url
    if (filters === true) {
        let time = document.getElementById("time").value;
        let dietary = document.getElementById("dietary").value;
        cost = document.getElementById("cost").value;
        if (time !== "") {
            console.log("There is a time filter =" + time);
            url += ("&amp;maxReadyTime=" + time);
        }
        if (dietary !== "") {
            console.log("There is a dietary filter =" + dietary);
            url += ("&amp;diet=" + dietary);
        }
        if (cost !== "") {
            console.log("There is a cost filter =" + cost);
        }
    }

    // Fetch the recipes into a promise
    const fetchPromise = fetch(url);

    // Get the final list of recipes after applying the cost filtering as needed
    const final = fetchPromise.then((response) => {
        return response.json();
    }).then((results) => {
        //storeRecipe(results, input);    
        let recipes = results["results"];    
        let output = [];
        if (filters === true) {
            output =  filterCost(recipes, Number(cost));
        }
        else{
            output = recipes;
        }
        return output;
    });
    
    // Prevent search button from automatically reloading the page
    if (event !== undefined) {
        event.preventDefault();
    }

    // Extract the actual list of recipes from the final promise
    let real = await final;

    // Maximum 5 recursive searches
    if (recurse === 5) {
        return real.slice(0, number);
    }

    // If not enough recipes after applying the filters recursively call this function again
    if (real.length + currsize &lt; number) {
        let temp = await getRecipes(event,filters, number, offset+number, (currsize + real.length), recurse + 1);
        real = real.concat(temp);
    }
    
    //retrieveRecipe(input);
    storeRecipe(real.slice(0, number));
    redirectPage();
    //Return up to the "number" amount of recipes
    //console.log(real.slice(0, number));
}

// function getSource(id){
//     let input = document.getElementById('search').value;
//     $.ajax({
//         url:"https://api.spoonacular.com/recipes/" + id +"/information?apiKey=d97a6e5c0e914bed85a619b32c3aa047",
//         success:function(response){
//             document.getElementById("sourceLink").innerHTML=response.sourceUrl;
//             //document.getElementById("sourceLink").href=response.sourceUrl;
//         }
//     })
// }

// function getRecipe(){
//     let input = document.getElementById('search').value;
//     $.ajax({
//         url:"https://api.spoonacular.com/recipes/complexSearch?apiKey=d97a6e5c0e914bed85a619b32c3aa047&amp;query="+input,
//         success:function(response){
//             console.log(response.baseUrl);
//             document.getElementById("img-output").src=response.baseUrl+response.results[o].image;
//             //getSource(response.results[0].id);
//         }
//     })
// }
//</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addUser">addUser</a></li><li><a href="global.html#convertTime">convertTime</a></li><li><a href="global.html#convertToBase64">convertToBase64</a></li><li><a href="global.html#createIngredientList">createIngredientList</a></li><li><a href="global.html#createRecipe">createRecipe</a></li><li><a href="global.html#createRecipeCards">createRecipeCards</a></li><li><a href="global.html#deleteRecipe">deleteRecipe</a></li><li><a href="global.html#favoriteRecipe">favoriteRecipe</a></li><li><a href="global.html#fetchRecipes">fetchRecipes</a></li><li><a href="global.html#filterCost">filterCost</a></li><li><a href="global.html#getOrganization">getOrganization</a></li><li><a href="global.html#getRecipe">getRecipe</a></li><li><a href="global.html#getRecipes">getRecipes</a></li><li><a href="global.html#getUrl">getUrl</a></li><li><a href="global.html#getUser">getUser</a></li><li><a href="global.html#imagePreview">imagePreview</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#loadRecipes">loadRecipes</a></li><li><a href="global.html#randomRecipe">randomRecipe</a></li><li><a href="global.html#recipeInfo">recipeInfo</a></li><li><a href="global.html#recipePage">recipePage</a></li><li><a href="global.html#redirectPage">redirectPage</a></li><li><a href="global.html#removeRecipe">removeRecipe</a></li><li><a href="global.html#retrieveRecipe">retrieveRecipe</a></li><li><a href="global.html#searchForKey">searchForKey</a></li><li><a href="global.html#signIn">signIn</a></li><li><a href="global.html#signUp">signUp</a></li><li><a href="global.html#storeRecipe">storeRecipe</a></li><li><a href="global.html#updateRecipe">updateRecipe</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Dec 05 2021 07:51:38 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
